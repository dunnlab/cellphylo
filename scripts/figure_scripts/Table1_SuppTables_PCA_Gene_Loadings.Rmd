---
title: "PCA gene loadings: Table 1 and Supplementary Tables 1 and 2"
output: html_notebook
---

Below is code used to create Supplementary Tables 1 and 2, which are the bases for Table 1.

Extract gene loadings
```{r}
setwd("~/repo/aqhumor/AqHum_5Species/")
ann_table <- "aqhumor_final/AqHumor_ensembl_orthologs_wrangled.tsv"
matrix_path <- "aqhumor_final/matrix_final/integrated/cross_species/cross_species_integrated/aqhumor_cross_species_integrated_mtx/"

gene_loadings <- extract_gene_loadings(ann_table = ann_table, matrix_path = matrix_path)

positive_df <- gene_loadings$by_most_Positive
negative_df <- gene_loadings$by_most_Negative
pca <- gene_loadings$PCA_output


```

Plot and save tables
```{r}
library(utils) #write.table

#Tables Publication
#plot the first 10 PCs and 10 most highly ranked genes
write.table(positive_df[1:10, 1:10], file = "top10_positive_Mah&Dunn2023.tsv", quote=FALSE, sep="\t",row.names=FALSE, col.names=TRUE)
write.table(negative_df[1:10, 1:10], file = "top10_negative_Mah&Dunn2023.tsv", quote=FALSE, sep="\t",row.names=FALSE, col.names=TRUE)

#pos_xtbl <- xtable(positive_df[1:10, 1:10])
#pos_print <- print(pos_xtbl, file="pos.html", type="html")
#neg_xtbl <- xtable(negative_df[1:10, 1:10])
#neg_print <- print(neg_xtbl, file="neg.html", type="html")

#Supplementary files

#save full tables as tsv files
write.table(positive_df, file = "positive_gene_loadings_Mah&Dunn2023.tsv", quote=FALSE, sep="\t",row.names=FALSE, col.names=TRUE)
write.table(negative_df, file = "negative_gene_loadings_Mah&Dunn2023.tsv", quote=FALSE, sep="\t",row.names=FALSE, col.names=TRUE)

#save PCA as R data object. Don't need to give the separate files below.
saveRDS(pca, file="PCA_919x919_matrix.rds")

#prints out full unsorted PCA loadings table (ie pca$rotation)
#pca_xtbl <- xtable(pca)
#print(pca_xtbl, file="pca_loadings_Mah&Dunn2023.html", type="html")
#prints out pca summary
#pca_summary_xtbl <- xtable(summary(pca))
#print <- print(pca_summary_xtbl, file="pca_summary_Mah&Dunn2023.html", type="html")

```


Table 1: Cell signals in gene loadings
Cross-referenced with gene_loadings_cell_signals - as correct
```{r}
PC <- c("PC1", "PC2", "PC3", "PC4", "PC5","PC6","PC7","PC8","PC9","PC10")
positive <- c("immune", "vessel endothelium", "NA", "fibroblast", "neural system", "NA", "NA", "NA", "immune - myeloid", "vessel endothelium")
negative <- c("muscle", "neural system", "muscle", "melanocyte", "immune", "NA", "neural system", "NA", "immune - lymphoid", "NA")

tbl1.df <- data.frame("Principal Component" = PC, "Positive Loading" = positive, "Negative Loading" = negative, check.names=FALSE)

write.table(tbl1.df, file = "Table1_Mah&Dunn2023.tsv", quote=FALSE, sep="\t",row.names=FALSE, col.names=TRUE)


```
input:
MD5 (AqHumor_ensembl_orthologs_wrangled.tsv) = ada408d5ee5e3a04e901d3469fdaf19c
MD5 (aqhumor_cross_species_integrated_mtx/matrix.mtx.gz) = daa2aef295e2b7f07f80de669b8a3c1c

output:
MD5 (neg.html) = 84e501fad42369c44ec42837da559bdc
MD5 (pos.html) = 35d1729951af2b5b9b28169941aed31f
MD5 (pca_loadings_Mah&Dunn2023.html) = 6c11c04780c7ed7a35441df29693154c
MD5 (negative_gene_loadings_Mah&Dunn2023.tsv) = f47b26318dfcdd64da368b004d286e66 >> 20 Apr 2023
MD5 (positive_gene_loadings_Mah&Dunn2023.tsv) = f41bc3c9b800de830c30a9134ac58144 >> 20 Apr 2023
MD5 (top10_negative_Mah&Dunn2023.tsv) = 95c4a7f4eb48d1c57e137c258b9c0017 >> 20 Apr 2023
MD5 (top10_positive_Mah&Dunn2023.tsv) = 79ac465c8dc7af49e1d899252fe3b43a >> 20 Apr 2023

manual work: as of Apr 14 2023
MD5 (gene_loadings_cell_signals.numbers) = ce9d8de954b6abac2ade1a3d800eed0f
MD5 (gene_loadings_cell_signals.tsv) = 5f3c04d3ecef1ab5c0c3cbe7b46ed394
MD5 (positive_NCBI_gene_descriptions.tsv) = f4115eab49c7117772ef7f1f37baf4e2
MD5 (negative_NCBI_gene_descriptions.tsv) = 3ff5b081b1202243c55c14adfb2ecc99
MD5 (PCA_919x919_matrix.rds) = 4fb295b106013b7915559eac6e2c8b6d >> apr 20 2023
Note:
Deleted old output files and results from original gene_loadings analysis. These analyses produced the same results/output but the above coding is cleaner.

for figures: touch up by hand on Word
MD5 (Table1_Mah&Dunn2023.tsv) = 897a37bb2c8ac318eee6838299f5bc03
MD5 (top10_negative_Mah&Dunn2023.csv) = a1d69691314f78519aeafadbc7b24b46
MD5 (top10_positive_Mah&Dunn2023.csv) = f4d59bc508fb219c98f22484b3e52b1c

MD5 (tables_mah&dunn2023.docx) = 8489f7fdafbae49960523ae858873ef2 >>  in progress, will probably change
