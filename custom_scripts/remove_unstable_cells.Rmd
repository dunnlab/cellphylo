---
title: "Remove unstable cells"
output: html_notebook
---

The following script intakes the 92 cell 20 PC matrix (Fig. S1, step x) and remove cell type groups that either: 1) consistently failed to form clades and disrupted other cell type clades, or 2) existed only in a single species. 

```{r}
library(Seurat)
library(DropletUtils)

setwd("~/repo/gene_pheno_ev/add_genomes/new/AqHum_5species/")
mat <- Read10X("aqhumor_final/jumble/92_jumble/contml_92cell_subset_pca_var_norm_20PC_mtx/")

#Beam A, Beam X, Epi-Corneal and Fibroblast are problem cells as judged by jumble search. The rest are singletons. Removes 35 tips, 57 remaining
#54 cell dataset -> remove BCell
black_list <- c("Beam-B", "Beam-Y", "CollectorChnlAqVein", "Corneal", "Endo", "Endo_Schlemms", "Epi-CiliaryNonPigment", "Epi-CiliaryPigment","Epi-Pigment", "MastCell", "Myoepithelium", "Neuron", "SchwalbeLine", "Uveal","Vascular","Beam-A", "Beam-X", "Epi-Corneal", "Fibroblast", "BCell")


cell_ids <- rownames(mat)
cell_type_ids <- sapply(strsplit(cell_ids, "_"), function(v){return(v[4])})

filter_index <- which(!(cell_type_ids %in% black_list))

mat_filt <- mat[filter_index,]

#write matrix
#write10xCounts("contml_57cell_subset_pca_var_norm_20PC_mtx", mat_filt, version="3")
write10xCounts("contml_54cell_subset_pca_var_norm_20PC_mtx", mat_filt, version="3")

#create infile
make_infile(matrix = mat_filt, print=TRUE)
```